using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class DronController : MonoBehaviour {

    public float dronSpeed; // public pozwala nam zmieniaæ z Inspektora wartoœæ danej zmiennej
    public float jumpForce;
    public Transform groundTester;
    public LayerMask LayersToTest;
    public Transform startPoint;
    public AudioClip clip;

    Animator anim;
    Rigidbody2D rgBody;

    private bool onTheGround; // tzn flaga, która dalej stanie siê warunkiem
    private float radius = 0.1f; //d³ugoœæ okrêgu z metody OverlapCircle do kolizji z gruntem

	// Use this for initialization
	void Start () {

        anim = GetComponent<Animator>(); //pobieramy Animatora danego obiektu tzn drona
        rgBody = GetComponent<Rigidbody2D>(); //pobieramy komponent RigidBody obiektu do którego przyklejony jest skrypt
		
	}


	
	// Update is called once per frame
	void Update () {

        if(anim.GetCurrentAnimatorStateInfo(0).IsName("Fail"))// warunek sprawdza , jeœli w³¹czy siê animacja 'Fail', to koñczy metode
        {
            rgBody.velocity = Vector2.zero; //zerujemy prêdkoœæ Drona
            return;
        }

        onTheGround = Physics2D.OverlapCircle (groundTester.position, radius, LayersToTest);
            //metoda sprawdza czy w danym okrêgu od obiektu, nie zachodz¹ z nim kolizje.



        float horizontalMove = Input.GetAxis("Horizontal"); //pobieramy do zmiennej o po³o¿eniu obiektu w poziomie
        rgBody.velocity = new Vector2(horizontalMove*dronSpeed, rgBody.velocity.y);
        //dodajemy nowy wektor, zmieniaj¹cy prêdkoœæ obiektu

        if(Input.GetKeyDown(KeyCode.Space) && onTheGround)
        {
            rgBody.AddForce(new Vector2(0f, jumpForce)); // dodajemy now¹ si³ê, która wywala drona do góry
            anim.SetTrigger("jump");// zapodajemy now¹ animacjê
            AudioSource.PlayClipAtPoint(clip, transform.position);
        }



        anim.SetFloat("speed", horizontalMove);
		
	}

    public void RestartDron()
    {
        gameObject.transform.position = startPoint.position;
    }
}
